{"ast":null,"code":"var _jsxFileName = \"/Users/guankaiyuan/ReactTs/src/components/Chatbot/Chatbot.tsx\",\n  _s = $RefreshSig$();\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { Subscription } from 'rxjs';\nimport './Chatbot.scss';\nimport JointPlusService from '../../services/joint-plus.service';\nimport Inspector from './Inspector/Inspector';\nimport EventBusServiceContext from '../../services/event-bus-service.context';\nimport { EventBusService } from '../../services/event-bus.service';\nimport { SharedEvents } from '../../joint-plus/controller';\nimport { importGraphFromJSON, loadStencilShapes, zoomToFit } from '../../joint-plus/actions'; //importGraphFromJSON\nimport { STENCIL_WIDTH } from '../../theme';\nimport exampleGraphJSON from '../../joint-plus/config/example-graph.json';\nconst Chatbot = () => {\n  _s();\n  const elementRef = useRef(null);\n  const toolbarRef = useRef(null);\n  const stencilRef = useRef(null);\n  const paperRef = useRef(null);\n  const [joint, setJoint] = useState(null);\n  const [eventBusService] = useState(new EventBusService());\n  // const [stencilOpened, setStencilOpened] = useState(true);\n  const [jsonEditorOpened, setJsonEditorOpened] = useState(true);\n  const [fileJSON, setFileJSON] = useState(null);\n  const [subscriptions] = useState(new Subscription());\n  const openFile = useCallback(json => {\n    setFileJSON(json);\n    importGraphFromJSON(joint, json);\n    zoomToFit(joint);\n  }, [joint]);\n  const onStart = useCallback(() => {\n    loadStencilShapes(joint);\n    openFile(exampleGraphJSON);\n  }, [joint, openFile]);\n  const onJsonEditorChange = useCallback(json => {\n    if (joint) {\n      importGraphFromJSON(joint, json);\n    }\n  }, [joint]);\n  const onJointGraphChange = useCallback(json => {\n    setFileJSON(json);\n  }, []);\n  const onStencilToggle = useCallback(() => {\n    if (!joint) {\n      return;\n    }\n    const {\n      scroller,\n      stencil\n    } = joint;\n    // if (stencilOpened) {\n    //     stencil.unfreeze();\n    //     scroller.el.scrollLeft += STENCIL_WIDTH;\n    // } else {\n    //     stencil.freeze();\n    //     scroller.el.scrollLeft -= STENCIL_WIDTH;\n    // }\n    //===========================================\n    stencil.unfreeze();\n    scroller.el.scrollLeft += STENCIL_WIDTH;\n    // }, [joint, stencilOpened]);\n    //===========================================\n  }, [joint]);\n\n  // const toggleJsonEditor = (): void => {\n  //     setJsonEditorOpened(!jsonEditorOpened);\n  // };\n\n  // const toggleStencil = (): void => {\n  //     setStencilOpened(!stencilOpened);\n  // };\n\n  useEffect(() => {\n    onStencilToggle();\n    // }, [stencilOpened, onStencilToggle]);\n  }, [onStencilToggle]);\n  const setStencilContainerSize = useCallback(() => {\n    stencilRef.current.style.width = `${STENCIL_WIDTH}px`;\n  }, []);\n  useEffect(() => {\n    subscriptions.add(eventBusService.subscribe(SharedEvents.GRAPH_CHANGED, json => onJointGraphChange(json)));\n    subscriptions.add(eventBusService.subscribe(SharedEvents.JSON_EDITOR_CHANGED, json => onJsonEditorChange(json)));\n  }, [eventBusService, subscriptions, onJointGraphChange, onJsonEditorChange]);\n  useEffect(() => {\n    setJoint(new JointPlusService(elementRef.current, paperRef.current, stencilRef.current, toolbarRef.current, eventBusService));\n  }, [eventBusService]);\n  useEffect(() => {\n    if (!joint) {\n      return;\n    }\n    setStencilContainerSize();\n    onStart();\n  }, [joint, onStart, setStencilContainerSize]);\n  useEffect(() => {\n    if (!joint) {\n      return;\n    }\n    return () => {\n      subscriptions.unsubscribe();\n      joint.destroy();\n    };\n  }, [joint, subscriptions]);\n  return /*#__PURE__*/React.createElement(EventBusServiceContext.Provider, {\n    value: eventBusService,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: elementRef,\n    className: \"joint-scope chatbot\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: toolbarRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"side-bar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: stencilRef\n    // style={{ display: stencilOpened ? 'initial' : 'none' }}\n    ,\n    className: \"stencil-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"main-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: paperRef,\n    className: \"paper-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(Inspector, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 17\n    }\n  })));\n};\n_s(Chatbot, \"KtSdEzNSihYIZ6pKIbbWcsMCDUo=\");\n_c = Chatbot;\nexport default Chatbot;\nvar _c;\n$RefreshReg$(_c, \"Chatbot\");","map":{"version":3,"names":["React","useCallback","useEffect","useRef","useState","Subscription","JointPlusService","Inspector","EventBusServiceContext","EventBusService","SharedEvents","importGraphFromJSON","loadStencilShapes","zoomToFit","STENCIL_WIDTH","exampleGraphJSON","Chatbot","_s","elementRef","toolbarRef","stencilRef","paperRef","joint","setJoint","eventBusService","jsonEditorOpened","setJsonEditorOpened","fileJSON","setFileJSON","subscriptions","openFile","json","onStart","onJsonEditorChange","onJointGraphChange","onStencilToggle","scroller","stencil","unfreeze","el","scrollLeft","setStencilContainerSize","current","style","width","add","subscribe","GRAPH_CHANGED","JSON_EDITOR_CHANGED","unsubscribe","destroy","createElement","Provider","value","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","ref","className","_c","$RefreshReg$"],"sources":["/Users/guankaiyuan/ReactTs/src/components/Chatbot/Chatbot.tsx"],"sourcesContent":["import React, { ReactElement, useCallback, useEffect, useRef, useState } from 'react';\nimport { Subscription } from 'rxjs';\n\nimport './Chatbot.scss';\nimport JointPlusService from '../../services/joint-plus.service';\nimport JsonEditor from './JsonEditor/JsonEditor';\nimport Inspector from './Inspector/Inspector';\nimport EventBusServiceContext from '../../services/event-bus-service.context';\nimport { EventBusService } from '../../services/event-bus.service';\nimport { SharedEvents } from '../../joint-plus/controller';\nimport { importGraphFromJSON, loadStencilShapes, zoomToFit } from '../../joint-plus/actions';//importGraphFromJSON\nimport { STENCIL_WIDTH } from '../../theme';\n\nimport exampleGraphJSON from '../../joint-plus/config/example-graph.json';\n\nconst Chatbot = (): ReactElement => {\n\n    const elementRef = useRef(null);\n    const toolbarRef = useRef(null);\n    const stencilRef = useRef(null);\n    const paperRef = useRef(null);\n\n    const [joint, setJoint] = useState(null);\n    const [eventBusService] = useState(new EventBusService());\n    // const [stencilOpened, setStencilOpened] = useState(true);\n    const [jsonEditorOpened, setJsonEditorOpened] = useState(true);\n    const [fileJSON, setFileJSON] = useState(null);\n    const [subscriptions] = useState(new Subscription());\n\n    const openFile = useCallback((json: Object): void => {\n        setFileJSON(json);\n        importGraphFromJSON(joint, json);\n        zoomToFit(joint);\n    }, [joint]);\n\n    const onStart = useCallback((): void => {\n        loadStencilShapes(joint);\n        openFile(exampleGraphJSON);\n    }, [joint, openFile]);\n\n    const onJsonEditorChange = useCallback((json: Object): void => {\n        if (joint) {\n            importGraphFromJSON(joint, json);\n        }\n    }, [joint]);\n\n    const onJointGraphChange = useCallback((json: Object): void => {\n        setFileJSON(json);\n    }, []);\n\n    const onStencilToggle = useCallback((): void => {\n        if (!joint) {\n            return;\n        }\n        const { scroller, stencil } = joint;\n        // if (stencilOpened) {\n        //     stencil.unfreeze();\n        //     scroller.el.scrollLeft += STENCIL_WIDTH;\n        // } else {\n        //     stencil.freeze();\n        //     scroller.el.scrollLeft -= STENCIL_WIDTH;\n        // }\n        //===========================================\n        stencil.unfreeze();\n        scroller.el.scrollLeft += STENCIL_WIDTH;\n        // }, [joint, stencilOpened]);\n        //===========================================\n    }, [joint,]);\n\n    // const toggleJsonEditor = (): void => {\n    //     setJsonEditorOpened(!jsonEditorOpened);\n    // };\n\n    // const toggleStencil = (): void => {\n    //     setStencilOpened(!stencilOpened);\n    // };\n\n    useEffect((): void => {\n        onStencilToggle();\n        // }, [stencilOpened, onStencilToggle]);\n    }, [onStencilToggle]);\n\n    const setStencilContainerSize = useCallback((): void => {\n        stencilRef.current.style.width = `${STENCIL_WIDTH}px`;\n    }, []);\n\n    useEffect(() => {\n        subscriptions.add(\n            eventBusService.subscribe(SharedEvents.GRAPH_CHANGED, (json: Object) => onJointGraphChange(json))\n        );\n        subscriptions.add(\n            eventBusService.subscribe(SharedEvents.JSON_EDITOR_CHANGED, (json: Object) => onJsonEditorChange(json))\n        );\n    }, [eventBusService, subscriptions, onJointGraphChange, onJsonEditorChange]);\n\n    useEffect(() => {\n        setJoint(new JointPlusService(\n            elementRef.current,\n            paperRef.current,\n            stencilRef.current,\n            toolbarRef.current,\n            eventBusService\n        ));\n    }, [eventBusService]);\n\n    useEffect(() => {\n        if (!joint) {\n            return;\n        }\n        setStencilContainerSize();\n        onStart();\n    }, [joint, onStart, setStencilContainerSize]);\n\n    useEffect(() => {\n        if (!joint) {\n            return;\n        }\n        return () => {\n            subscriptions.unsubscribe();\n            joint.destroy();\n        };\n    }, [joint, subscriptions]);\n\n    return (\n        <EventBusServiceContext.Provider value={eventBusService}>\n            <div ref={elementRef} className=\"joint-scope chatbot\">\n                <div ref={toolbarRef} />\n                <div className=\"side-bar\">\n                    {/* <div className=\"toggle-bar\">\n                        <div onClick={toggleStencil}\n                            className={'icon toggle-stencil ' + (!stencilOpened ? 'disabled-icon' : '')}\n                            data-tooltip=\"Toggle Element Palette\"\n                            data-tooltip-position-selector=\".toggle-bar\" />\n                        <div onClick={toggleJsonEditor}\n                            className={'icon toggle-editor ' + (!jsonEditorOpened ? 'disabled-icon' : '')}\n                            data-tooltip=\"Toggle JSON Editor\"\n                            data-tooltip-position-selector=\".toggle-bar\" />\n                    </div> */}\n                    <div ref={stencilRef}\n                        // style={{ display: stencilOpened ? 'initial' : 'none' }}\n                        className=\"stencil-container\" />\n                </div>\n                <div className=\"main-container\">\n                    <div ref={paperRef} className=\"paper-container\" />\n                    <div //style={{ display: jsonEditorOpened ? 'initial' : 'none' }}\n                    >\n                        {/* <JsonEditor content={fileJSON} />//json åŸŸ */}\n                    </div>\n                </div>\n                <Inspector />\n            </div>\n        </EventBusServiceContext.Provider>\n    );\n};\n\nexport default Chatbot;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}