{"ast":null,"code":"var _jsxFileName = \"/Users/guankaiyuan/ReactTs/src/components/Chatbot/Chatbot.tsx\",\n  _s = $RefreshSig$();\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { Subscription } from 'rxjs';\nimport './Chatbot.scss';\nimport JointPlusService from '../../services/joint-plus.service';\nimport EventBusServiceContext from '../../services/event-bus-service.context';\nimport { EventBusService } from '../../services/event-bus.service';\nimport { SharedEvents } from '../../joint-plus/controller';\nimport { importGraphFromJSON, loadStencilShapes, zoomToFit } from '../../joint-plus/actions';\nimport { STENCIL_WIDTH } from '../../theme';\nimport exampleGraphJSON from '../../joint-plus/config/example-graph.json';\nconst Chatbot = () => {\n  _s();\n  const elementRef = useRef(null);\n  const toolbarRef = useRef(null);\n  const stencilRef = useRef(null);\n  const paperRef = useRef(null);\n  const [joint, setJoint] = useState(null);\n  const [eventBusService] = useState(new EventBusService());\n  const [stencilOpened, setStencilOpened] = useState(true);\n  const [jsonEditorOpened, setJsonEditorOpened] = useState(true);\n  const [fileJSON, setFileJSON] = useState(null);\n  const [subscriptions] = useState(new Subscription());\n  const openFile = useCallback(json => {\n    setFileJSON(json);\n    importGraphFromJSON(joint, json);\n    zoomToFit(joint);\n  }, [joint]);\n  const onStart = useCallback(() => {\n    loadStencilShapes(joint);\n    openFile(exampleGraphJSON);\n  }, [joint, openFile]);\n  const onJsonEditorChange = useCallback(json => {\n    if (joint) {\n      importGraphFromJSON(joint, json);\n    }\n  }, [joint]);\n  const onJointGraphChange = useCallback(json => {\n    setFileJSON(json);\n  }, []);\n  const onStencilToggle = useCallback(() => {\n    if (!joint) {\n      return;\n    }\n    const {\n      scroller,\n      stencil\n    } = joint;\n    if (stencilOpened) {\n      stencil.unfreeze();\n      scroller.el.scrollLeft += STENCIL_WIDTH;\n    } else {\n      stencil.freeze();\n      scroller.el.scrollLeft -= STENCIL_WIDTH;\n    }\n  }, [joint, stencilOpened]);\n  const toggleJsonEditor = () => {\n    setJsonEditorOpened(!jsonEditorOpened);\n  };\n  const toggleStencil = () => {\n    setStencilOpened(!stencilOpened);\n  };\n\n  // useEffect((): void => {\n  //     onStencilToggle();\n  // }, [stencilOpened, onStencilToggle]);\n\n  // const setStencilContainerSize = useCallback((): void => {\n  //     stencilRef.current.style.width = `${STENCIL_WIDTH}px`;\n  // }, []);\n\n  useEffect(() => {\n    subscriptions.add(eventBusService.subscribe(SharedEvents.GRAPH_CHANGED, json => onJointGraphChange(json)));\n    subscriptions.add(eventBusService.subscribe(SharedEvents.JSON_EDITOR_CHANGED, json => onJsonEditorChange(json)));\n  }, [eventBusService, subscriptions, onJointGraphChange, onJsonEditorChange]);\n  useEffect(() => {\n    setJoint(new JointPlusService(elementRef.current, paperRef.current, stencilRef.current, toolbarRef.current, eventBusService));\n  }, [eventBusService]);\n  useEffect(() => {\n    if (!joint) {\n      return;\n    }\n    setStencilContainerSize();\n    onStart();\n  }, [joint, onStart, setStencilContainerSize]);\n  useEffect(() => {\n    if (!joint) {\n      return;\n    }\n    return () => {\n      subscriptions.unsubscribe();\n      joint.destroy();\n    };\n  }, [joint, subscriptions]);\n  return /*#__PURE__*/React.createElement(EventBusServiceContext.Provider, {\n    value: eventBusService,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: elementRef,\n    className: \"joint-scope chatbot\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: toolbarRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"side-bar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: stencilRef,\n    style: {\n      display: stencilOpened ? 'initial' : 'none'\n    },\n    className: \"stencil-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"main-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: paperRef,\n    className: \"paper-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 21\n    }\n  }))));\n};\n_s(Chatbot, \"GmRf3HZiy2ts+jcFDdp+58ZHkOw=\");\n_c = Chatbot;\nexport default Chatbot;\nvar _c;\n$RefreshReg$(_c, \"Chatbot\");","map":{"version":3,"names":["React","useCallback","useEffect","useRef","useState","Subscription","JointPlusService","EventBusServiceContext","EventBusService","SharedEvents","importGraphFromJSON","loadStencilShapes","zoomToFit","STENCIL_WIDTH","exampleGraphJSON","Chatbot","_s","elementRef","toolbarRef","stencilRef","paperRef","joint","setJoint","eventBusService","stencilOpened","setStencilOpened","jsonEditorOpened","setJsonEditorOpened","fileJSON","setFileJSON","subscriptions","openFile","json","onStart","onJsonEditorChange","onJointGraphChange","onStencilToggle","scroller","stencil","unfreeze","el","scrollLeft","freeze","toggleJsonEditor","toggleStencil","add","subscribe","GRAPH_CHANGED","JSON_EDITOR_CHANGED","current","setStencilContainerSize","unsubscribe","destroy","createElement","Provider","value","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","ref","className","style","display","_c","$RefreshReg$"],"sources":["/Users/guankaiyuan/ReactTs/src/components/Chatbot/Chatbot.tsx"],"sourcesContent":["import React, { ReactElement, useCallback, useEffect, useRef, useState } from 'react';\nimport { Subscription } from 'rxjs';\n\nimport './Chatbot.scss';\nimport JointPlusService from '../../services/joint-plus.service';\nimport JsonEditor from './JsonEditor/JsonEditor';\nimport Inspector from './Inspector/Inspector';\nimport EventBusServiceContext from '../../services/event-bus-service.context';\nimport { EventBusService } from '../../services/event-bus.service';\nimport { SharedEvents } from '../../joint-plus/controller';\nimport { importGraphFromJSON, loadStencilShapes, zoomToFit } from '../../joint-plus/actions';\nimport { STENCIL_WIDTH } from '../../theme';\n\nimport exampleGraphJSON from '../../joint-plus/config/example-graph.json';\n\nconst Chatbot = (): ReactElement => {\n\n    const elementRef = useRef(null);\n    const toolbarRef = useRef(null);\n    const stencilRef = useRef(null);\n    const paperRef = useRef(null);\n\n    const [joint, setJoint] = useState(null);\n    const [eventBusService] = useState(new EventBusService());\n    const [stencilOpened, setStencilOpened] = useState(true);\n    const [jsonEditorOpened, setJsonEditorOpened] = useState(true);\n    const [fileJSON, setFileJSON] = useState(null);\n    const [subscriptions] = useState(new Subscription());\n\n    const openFile = useCallback((json: Object): void => {\n        setFileJSON(json);\n        importGraphFromJSON(joint, json);\n        zoomToFit(joint);\n    }, [joint]);\n\n    const onStart = useCallback((): void => {\n        loadStencilShapes(joint);\n        openFile(exampleGraphJSON);\n    }, [joint, openFile]);\n\n    const onJsonEditorChange = useCallback((json: Object): void => {\n        if (joint) {\n            importGraphFromJSON(joint, json);\n        }\n    }, [joint]);\n\n    const onJointGraphChange = useCallback((json: Object): void => {\n        setFileJSON(json);\n    }, []);\n\n    const onStencilToggle = useCallback((): void => {\n        if (!joint) {\n            return;\n        }\n        const { scroller, stencil } = joint;\n        if (stencilOpened) {\n            stencil.unfreeze();\n            scroller.el.scrollLeft += STENCIL_WIDTH;\n        } else {\n            stencil.freeze();\n            scroller.el.scrollLeft -= STENCIL_WIDTH;\n        }\n    }, [joint, stencilOpened]);\n\n    const toggleJsonEditor = (): void => {\n        setJsonEditorOpened(!jsonEditorOpened);\n    };\n\n    const toggleStencil = (): void => {\n        setStencilOpened(!stencilOpened);\n    };\n\n    // useEffect((): void => {\n    //     onStencilToggle();\n    // }, [stencilOpened, onStencilToggle]);\n\n    // const setStencilContainerSize = useCallback((): void => {\n    //     stencilRef.current.style.width = `${STENCIL_WIDTH}px`;\n    // }, []);\n\n    useEffect(() => {\n        subscriptions.add(\n            eventBusService.subscribe(SharedEvents.GRAPH_CHANGED, (json: Object) => onJointGraphChange(json))\n        );\n        subscriptions.add(\n            eventBusService.subscribe(SharedEvents.JSON_EDITOR_CHANGED, (json: Object) => onJsonEditorChange(json))\n        );\n    }, [eventBusService, subscriptions, onJointGraphChange, onJsonEditorChange]);\n\n    useEffect(() => {\n        setJoint(new JointPlusService(\n            elementRef.current,\n            paperRef.current,\n            stencilRef.current,\n            toolbarRef.current,\n            eventBusService\n        ));\n    }, [eventBusService]);\n\n    useEffect(() => {\n        if (!joint) {\n            return;\n        }\n        setStencilContainerSize();\n        onStart();\n    }, [joint, onStart, setStencilContainerSize]);\n\n    useEffect(() => {\n        if (!joint) {\n            return;\n        }\n        return () => {\n            subscriptions.unsubscribe();\n            joint.destroy();\n        };\n    }, [joint, subscriptions]);\n\n    return (\n        <EventBusServiceContext.Provider value={eventBusService}>\n            <div ref={elementRef} className=\"joint-scope chatbot\">\n                <div ref={toolbarRef} />\n                <div className=\"side-bar\">\n                    {/* <div className=\"toggle-bar\"> */}\n                    {/* <div onClick={toggleStencil}\n                            className={'icon toggle-stencil ' + (!stencilOpened ? 'disabled-icon' : '')}\n                            data-tooltip=\"Toggle Element Palette\"\n                            data-tooltip-position-selector=\".toggle-bar\" /> */}\n                    {/* <div onClick={toggleJsonEditor}\n                            className={'icon toggle-editor ' + (!jsonEditorOpened ? 'disabled-icon' : '')}\n                            data-tooltip=\"Toggle JSON Editor\"\n                            data-tooltip-position-selector=\".toggle-bar\" /> */}\n                    {/* </div> */}\n                    <div ref={stencilRef}\n                        style={{ display: stencilOpened ? 'initial' : 'none' }}\n                        className=\"stencil-container\" />\n                </div>\n                <div className=\"main-container\">\n                    <div ref={paperRef} className=\"paper-container\" />\n                    {/* <div style={{ display: jsonEditorOpened ? 'initial' : 'none' }}>\n                        <JsonEditor content={fileJSON}/> json域\n                    </div> */}\n                </div>\n                {/* <Inspector /> 右边不知道干什么的*/}\n            </div>\n        </EventBusServiceContext.Provider>\n    );\n};\n\nexport default Chatbot;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}