{"ast":null,"code":"var _jsxFileName = \"/Users/guankaiyuan/ReactTs/src/components/Chatbot/Chatbot.tsx\",\n  _s = $RefreshSig$();\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { Subscription } from 'rxjs';\nimport './Chatbot.scss';\nimport JointPlusService from '../../services/joint-plus.service';\nimport EventBusServiceContext from '../../services/event-bus-service.context';\nimport { EventBusService } from '../../services/event-bus.service';\nimport { SharedEvents } from '../../joint-plus/controller';\nimport { importGraphFromJSON, loadStencilShapes, zoomToFit } from '../../joint-plus/actions';\nimport { STENCIL_WIDTH } from '../../theme';\nimport exampleGraphJSON from '../../joint-plus/config/example-graph.json';\nconst Chatbot = () => {\n  _s();\n  const elementRef = useRef(null);\n  const toolbarRef = useRef(null);\n  const stencilRef = useRef(null);\n  const paperRef = useRef(null);\n  const [joint, setJoint] = useState(null);\n  const [eventBusService] = useState(new EventBusService());\n  // const [stencilOpened, setStencilOpened] = useState(true);\n  const [jsonEditorOpened, setJsonEditorOpened] = useState(true);\n  const [fileJSON, setFileJSON] = useState(null);\n  const [subscriptions] = useState(new Subscription());\n  const openFile = useCallback(json => {\n    setFileJSON(json);\n    importGraphFromJSON(joint, json);\n    zoomToFit(joint);\n  }, [joint]);\n  const onStart = useCallback(() => {\n    loadStencilShapes(joint);\n    openFile(exampleGraphJSON);\n  }, [joint, openFile]);\n  const onJsonEditorChange = useCallback(json => {\n    if (joint) {\n      importGraphFromJSON(joint, json);\n    }\n  }, [joint]);\n  const onJointGraphChange = useCallback(json => {\n    setFileJSON(json);\n  }, []);\n  const onStencilToggle = useCallback(() => {\n    if (!joint) {\n      return;\n    }\n    const {\n      scroller,\n      stencil\n    } = joint;\n    if (stencilOpened) {\n      stencil.unfreeze();\n      scroller.el.scrollLeft += STENCIL_WIDTH;\n    } else {\n      stencil.freeze();\n      scroller.el.scrollLeft -= STENCIL_WIDTH;\n    }\n  }, [joint, stencilOpened]);\n  const toggleJsonEditor = () => {\n    setJsonEditorOpened(!jsonEditorOpened);\n  };\n  const toggleStencil = () => {\n    setStencilOpened(!stencilOpened);\n  };\n  useEffect(() => {\n    onStencilToggle();\n  }, [stencilOpened, onStencilToggle]);\n  const setStencilContainerSize = useCallback(() => {\n    stencilRef.current.style.width = `${STENCIL_WIDTH}px`;\n  }, []);\n  useEffect(() => {\n    subscriptions.add(eventBusService.subscribe(SharedEvents.GRAPH_CHANGED, json => onJointGraphChange(json)));\n    subscriptions.add(eventBusService.subscribe(SharedEvents.JSON_EDITOR_CHANGED, json => onJsonEditorChange(json)));\n  }, [eventBusService, subscriptions, onJointGraphChange, onJsonEditorChange]);\n  useEffect(() => {\n    setJoint(new JointPlusService(elementRef.current, paperRef.current, stencilRef.current, toolbarRef.current, eventBusService));\n  }, [eventBusService]);\n  useEffect(() => {\n    if (!joint) {\n      return;\n    }\n    setStencilContainerSize();\n    onStart();\n  }, [joint, onStart, setStencilContainerSize]);\n  useEffect(() => {\n    if (!joint) {\n      return;\n    }\n    return () => {\n      subscriptions.unsubscribe();\n      joint.destroy();\n    };\n  }, [joint, subscriptions]);\n  return /*#__PURE__*/React.createElement(EventBusServiceContext.Provider, {\n    value: eventBusService,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: elementRef,\n    className: \"joint-scope chatbot\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: toolbarRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"side-bar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: stencilRef,\n    style: {\n      display: stencilOpened ? 'initial' : 'none'\n    },\n    className: \"stencil-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"main-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: paperRef,\n    className: \"paper-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 21\n    }\n  }))));\n};\n_s(Chatbot, \"KtSdEzNSihYIZ6pKIbbWcsMCDUo=\");\n_c = Chatbot;\nexport default Chatbot;\nvar _c;\n$RefreshReg$(_c, \"Chatbot\");","map":{"version":3,"names":["React","useCallback","useEffect","useRef","useState","Subscription","JointPlusService","EventBusServiceContext","EventBusService","SharedEvents","importGraphFromJSON","loadStencilShapes","zoomToFit","STENCIL_WIDTH","exampleGraphJSON","Chatbot","_s","elementRef","toolbarRef","stencilRef","paperRef","joint","setJoint","eventBusService","jsonEditorOpened","setJsonEditorOpened","fileJSON","setFileJSON","subscriptions","openFile","json","onStart","onJsonEditorChange","onJointGraphChange","onStencilToggle","scroller","stencil","stencilOpened","unfreeze","el","scrollLeft","freeze","toggleJsonEditor","toggleStencil","setStencilOpened","setStencilContainerSize","current","style","width","add","subscribe","GRAPH_CHANGED","JSON_EDITOR_CHANGED","unsubscribe","destroy","createElement","Provider","value","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","ref","className","display","_c","$RefreshReg$"],"sources":["/Users/guankaiyuan/ReactTs/src/components/Chatbot/Chatbot.tsx"],"sourcesContent":["import React, { ReactElement, useCallback, useEffect, useRef, useState } from 'react';\nimport { Subscription } from 'rxjs';\n\nimport './Chatbot.scss';\nimport JointPlusService from '../../services/joint-plus.service';\nimport JsonEditor from './JsonEditor/JsonEditor';\nimport Inspector from './Inspector/Inspector';\nimport EventBusServiceContext from '../../services/event-bus-service.context';\nimport { EventBusService } from '../../services/event-bus.service';\nimport { SharedEvents } from '../../joint-plus/controller';\nimport { importGraphFromJSON, loadStencilShapes, zoomToFit } from '../../joint-plus/actions';\nimport { STENCIL_WIDTH } from '../../theme';\n\nimport exampleGraphJSON from '../../joint-plus/config/example-graph.json';\n\nconst Chatbot = (): ReactElement => {\n\n    const elementRef = useRef(null);\n    const toolbarRef = useRef(null);\n    const stencilRef = useRef(null);\n    const paperRef = useRef(null);\n\n    const [joint, setJoint] = useState(null);\n    const [eventBusService] = useState(new EventBusService());\n    // const [stencilOpened, setStencilOpened] = useState(true);\n    const [jsonEditorOpened, setJsonEditorOpened] = useState(true);\n    const [fileJSON, setFileJSON] = useState(null);\n    const [subscriptions] = useState(new Subscription());\n\n    const openFile = useCallback((json: Object): void => {\n        setFileJSON(json);\n        importGraphFromJSON(joint, json);\n        zoomToFit(joint);\n    }, [joint]);\n\n    const onStart = useCallback((): void => {\n        loadStencilShapes(joint);\n        openFile(exampleGraphJSON);\n    }, [joint, openFile]);\n\n    const onJsonEditorChange = useCallback((json: Object): void => {\n        if (joint) {\n            importGraphFromJSON(joint, json);\n        }\n    }, [joint]);\n\n    const onJointGraphChange = useCallback((json: Object): void => {\n        setFileJSON(json);\n    }, []);\n\n    const onStencilToggle = useCallback((): void => {\n        if (!joint) {\n            return;\n        }\n        const { scroller, stencil } = joint;\n        if (stencilOpened) {\n            stencil.unfreeze();\n            scroller.el.scrollLeft += STENCIL_WIDTH;\n        } else {\n            stencil.freeze();\n            scroller.el.scrollLeft -= STENCIL_WIDTH;\n        }\n    }, [joint, stencilOpened]);\n\n    const toggleJsonEditor = (): void => {\n        setJsonEditorOpened(!jsonEditorOpened);\n    };\n\n    const toggleStencil = (): void => {\n        setStencilOpened(!stencilOpened);\n    };\n\n    useEffect((): void => {\n        onStencilToggle();\n    }, [stencilOpened, onStencilToggle]);\n\n    const setStencilContainerSize = useCallback((): void => {\n        stencilRef.current.style.width = `${STENCIL_WIDTH}px`;\n    }, []);\n\n    useEffect(() => {\n        subscriptions.add(\n            eventBusService.subscribe(SharedEvents.GRAPH_CHANGED, (json: Object) => onJointGraphChange(json))\n        );\n        subscriptions.add(\n            eventBusService.subscribe(SharedEvents.JSON_EDITOR_CHANGED, (json: Object) => onJsonEditorChange(json))\n        );\n    }, [eventBusService, subscriptions, onJointGraphChange, onJsonEditorChange]);\n\n    useEffect(() => {\n        setJoint(new JointPlusService(\n            elementRef.current,\n            paperRef.current,\n            stencilRef.current,\n            toolbarRef.current,\n            eventBusService\n        ));\n    }, [eventBusService]);\n\n    useEffect(() => {\n        if (!joint) {\n            return;\n        }\n        setStencilContainerSize();\n        onStart();\n    }, [joint, onStart, setStencilContainerSize]);\n\n    useEffect(() => {\n        if (!joint) {\n            return;\n        }\n        return () => {\n            subscriptions.unsubscribe();\n            joint.destroy();\n        };\n    }, [joint, subscriptions]);\n\n    return (\n        <EventBusServiceContext.Provider value={eventBusService}>\n            <div ref={elementRef} className=\"joint-scope chatbot\">\n                <div ref={toolbarRef} />\n                <div className=\"side-bar\">\n                    {/* <div className=\"toggle-bar\"> */}\n                    {/* <div onClick={toggleStencil}\n                            className={'icon toggle-stencil ' + (!stencilOpened ? 'disabled-icon' : '')}\n                            data-tooltip=\"Toggle Element Palette\"\n                            data-tooltip-position-selector=\".toggle-bar\" /> */}\n                    {/* <div onClick={toggleJsonEditor}\n                            className={'icon toggle-editor ' + (!jsonEditorOpened ? 'disabled-icon' : '')}\n                            data-tooltip=\"Toggle JSON Editor\"\n                            data-tooltip-position-selector=\".toggle-bar\" /> */}\n                    {/* </div> */}\n                    <div ref={stencilRef}\n                        style={{ display: stencilOpened ? 'initial' : 'none' }}\n                        className=\"stencil-container\" />\n                </div>\n                <div className=\"main-container\">\n                    <div ref={paperRef} className=\"paper-container\" />\n                    {/* <div style={{ display: jsonEditorOpened ? 'initial' : 'none' }}>\n                        <JsonEditor content={fileJSON}/> json域\n                    </div> */}\n                </div>\n                {/* <Inspector /> 右边不知道干什么的*/}\n            </div>\n        </EventBusServiceContext.Provider>\n    );\n};\n\nexport default Chatbot;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}