{"ast":null,"code":"/*! JointJS+ v4.0.0 - HTML5 Diagramming Framework - TRIAL VERSION\n\nCopyright (c) 2024 client IO\n\n 2024-02-18 \n\n\nThis Source Code Form is subject to the terms of the JointJS+ Trial License\n, v. 2.0. If a copy of the JointJS+ License was not distributed with this\nfile, You can obtain one at https://www.jointjs.com/license\n or from the JointJS+ archive as was distributed by client IO. See the LICENSE file.*/\n\nimport { util } from '@joint/plus';\nimport { Controller, SharedEvents } from '../controller';\nimport * as actions from '../actions';\nimport { ZOOM_MIN, ZOOM_MAX, ZOOM_STEP } from '../../theme';\nconst DEBOUNCE_TIME_MS = 500;\nexport class JointPlusController extends Controller {\n  startListening() {\n    const {\n      graph,\n      paper,\n      toolbar,\n      history,\n      eventBusService\n    } = this.service;\n    this.listenTo(eventBusService, {\n      [SharedEvents.GRAPH_START_BATCH]: onGraphStartBatch,\n      [SharedEvents.GRAPH_STOP_BATCH]: onGraphStopBatch\n    });\n    this.listenTo(graph, {\n      'add': onCellAdd,\n      'remove': onCellRemove,\n      'change:ports': onElementPortsChange\n    });\n    this.listenTo(history, {\n      'stack': util.debounce(onHistoryChange, DEBOUNCE_TIME_MS)\n    });\n    this.listenTo(paper, {\n      'paper:pinch': onPaperPinch,\n      'paper:pan': onPaperPan,\n      'blank:pointerdown': onPaperBlankPointerdown,\n      'cell:pointerup': onPaperCellPointerup,\n      'cell:tool:remove': onPaperCellToolRemove,\n      'element:pointermove': onPaperElementPointermove,\n      'element:pointerup': onPaperElementPointerup,\n      'element:port:add': onPaperElementPortAdd,\n      'element:port:remove': onPaperElementPortRemove,\n      'scale': onPaperScale\n    });\n    this.listenTo(toolbar, {\n      'png:pointerclick': onToolbarPNGPointerclick\n    });\n  }\n}\n\n// Event Bus Service\n\nfunction onGraphStartBatch(service, batchName) {\n  const {\n    graph\n  } = service;\n  graph.startBatch(batchName);\n}\nfunction onGraphStopBatch(service, batchName) {\n  const {\n    graph\n  } = service;\n  graph.stopBatch(batchName);\n}\n\n// Graph\n\nfunction onCellAdd(service, cell) {\n  if (cell.isLink()) return;\n  actions.setSelection(service, [cell]);\n  actions.updateLinksRouting(service);\n}\nfunction onCellRemove(service, removedCell) {\n  const {\n    selection\n  } = service;\n  if (!selection.includes(removedCell)) return;\n  actions.setSelection(service, selection.filter(cell => cell !== removedCell));\n  if (removedCell.isElement()) {\n    actions.updateLinksRouting(service);\n  }\n}\nfunction onElementPortsChange(_service, message) {\n  message.toggleAddPortButton('out');\n}\nfunction onHistoryChange(service) {\n  const {\n    graph,\n    eventBusService\n  } = service;\n  eventBusService.emit(SharedEvents.GRAPH_CHANGED, graph.toJSON());\n}\n\n// Paper\n\nfunction onPaperBlankPointerdown(service, evt) {\n  const {\n    scroller\n  } = service;\n  actions.setSelection(service, []);\n  scroller.startPanning(evt);\n}\nfunction onPaperPinch(service, evt, ox, oy, scale) {\n  const {\n    scroller\n  } = service;\n  evt.preventDefault();\n  scroller.zoom(scale - 1, {\n    min: ZOOM_MIN,\n    max: ZOOM_MAX,\n    grid: ZOOM_STEP,\n    ox,\n    oy\n  });\n}\nfunction onPaperPan(service, evt, tx, ty) {\n  const {\n    scroller\n  } = service;\n  evt.preventDefault();\n  scroller.el.scrollLeft += tx;\n  scroller.el.scrollTop += ty;\n}\nfunction onPaperCellPointerup(service, cellView) {\n  actions.setSelection(service, [cellView.model]);\n}\nfunction onPaperElementPointermove(service, elementView, evt) {\n  const {\n    paper\n  } = service;\n  const {\n    data\n  } = evt;\n  // Run the code below on the first `pointermove` event only\n  if (data.pointermoveCalled) return;\n  data.pointermoveCalled = true;\n  paper.hideTools();\n}\nfunction onPaperElementPointerup(service, _elementView, evt) {\n  const {\n    paper\n  } = service;\n  const {\n    data\n  } = evt;\n  if (!data.pointermoveCalled) return;\n  paper.showTools();\n  actions.updateLinksRouting(service);\n}\nfunction onPaperElementPortAdd(_service, elementView, evt) {\n  evt.stopPropagation();\n  const message = elementView.model;\n  message.addDefaultPort();\n}\nfunction onPaperElementPortRemove(_service, elementView, evt) {\n  evt.stopPropagation();\n  const portId = elementView.findAttribute('port', evt.target);\n  const message = elementView.model;\n  message.removePort(portId);\n}\nfunction onPaperCellToolRemove(_service, cellView, _evt) {\n  cellView.model.remove();\n}\nfunction onPaperScale(service) {\n  const {\n    tooltip\n  } = service;\n  tooltip.hide();\n}\n\n// Toolbar\n\nfunction onToolbarPNGPointerclick(service) {\n  actions.exportToPNG(service);\n}","map":{"version":3,"names":["util","Controller","SharedEvents","actions","ZOOM_MIN","ZOOM_MAX","ZOOM_STEP","DEBOUNCE_TIME_MS","JointPlusController","startListening","graph","paper","toolbar","history","eventBusService","service","listenTo","GRAPH_START_BATCH","onGraphStartBatch","GRAPH_STOP_BATCH","onGraphStopBatch","onCellAdd","onCellRemove","onElementPortsChange","debounce","onHistoryChange","onPaperPinch","onPaperPan","onPaperBlankPointerdown","onPaperCellPointerup","onPaperCellToolRemove","onPaperElementPointermove","onPaperElementPointerup","onPaperElementPortAdd","onPaperElementPortRemove","onPaperScale","onToolbarPNGPointerclick","batchName","startBatch","stopBatch","cell","isLink","setSelection","updateLinksRouting","removedCell","selection","includes","filter","isElement","_service","message","toggleAddPortButton","emit","GRAPH_CHANGED","toJSON","evt","scroller","startPanning","ox","oy","scale","preventDefault","zoom","min","max","grid","tx","ty","el","scrollLeft","scrollTop","cellView","model","elementView","data","pointermoveCalled","hideTools","_elementView","showTools","stopPropagation","addDefaultPort","portId","findAttribute","target","removePort","_evt","remove","tooltip","hide","exportToPNG"],"sources":["/Users/guankaiyuan/ReactTs/src/joint-plus/controllers/joint-plus.controller.ts"],"sourcesContent":["/*! JointJS+ v4.0.0 - HTML5 Diagramming Framework - TRIAL VERSION\n\nCopyright (c) 2024 client IO\n\n 2024-02-18 \n\n\nThis Source Code Form is subject to the terms of the JointJS+ Trial License\n, v. 2.0. If a copy of the JointJS+ License was not distributed with this\nfile, You can obtain one at https://www.jointjs.com/license\n or from the JointJS+ archive as was distributed by client IO. See the LICENSE file.*/\n\n\nimport { dia, shapes, util } from '@joint/plus';\n\nimport JointPlusService from '../../services/joint-plus.service';\nimport { Controller, SharedEvents } from '../controller';\nimport * as actions from '../actions';\nimport { ZOOM_MIN, ZOOM_MAX, ZOOM_STEP } from '../../theme';\n\nconst DEBOUNCE_TIME_MS = 500;\n\nexport class JointPlusController extends Controller {\n\n    startListening() {\n\n        const { graph, paper, toolbar, history, eventBusService } = this.service;\n\n        this.listenTo(eventBusService, {\n            [SharedEvents.GRAPH_START_BATCH]: onGraphStartBatch,\n            [SharedEvents.GRAPH_STOP_BATCH]: onGraphStopBatch,\n        });\n\n        this.listenTo(graph, {\n            'add': onCellAdd,\n            'remove': onCellRemove,\n            'change:ports': onElementPortsChange,\n        });\n\n        this.listenTo(history, {\n            'stack': util.debounce(onHistoryChange, DEBOUNCE_TIME_MS),\n        });\n\n        this.listenTo(paper, {\n            'paper:pinch': onPaperPinch,\n            'paper:pan': onPaperPan,\n            'blank:pointerdown': onPaperBlankPointerdown,\n            'cell:pointerup': onPaperCellPointerup,\n            'cell:tool:remove': onPaperCellToolRemove,\n            'element:pointermove': onPaperElementPointermove,\n            'element:pointerup': onPaperElementPointerup,\n            'element:port:add': onPaperElementPortAdd,\n            'element:port:remove': onPaperElementPortRemove,\n            'scale': onPaperScale,\n        });\n\n        this.listenTo(toolbar, {\n            'png:pointerclick': onToolbarPNGPointerclick,\n        });\n    }\n}\n\n// Event Bus Service\n\nfunction onGraphStartBatch(service: JointPlusService, batchName: string): void {\n    const { graph } = service;\n    graph.startBatch(batchName);\n}\n\nfunction onGraphStopBatch(service: JointPlusService, batchName: string): void {\n    const { graph } = service;\n    graph.stopBatch(batchName);\n}\n\n// Graph\n\nfunction onCellAdd(service: JointPlusService, cell: dia.Cell): void {\n    if (cell.isLink()) return;\n    actions.setSelection(service, [cell]);\n    actions.updateLinksRouting(service);\n}\n\nfunction onCellRemove(service: JointPlusService, removedCell: dia.Cell): void {\n    const { selection } = service;\n    if (!selection.includes(removedCell)) return;\n    actions.setSelection(service, selection.filter(cell => cell !== removedCell));\n    if (removedCell.isElement()) {\n        actions.updateLinksRouting(service);\n    }\n}\n\nfunction onElementPortsChange(_service: JointPlusService, message: shapes.app.Message): void {\n    message.toggleAddPortButton('out');\n}\n\nfunction onHistoryChange(service: JointPlusService): void {\n    const { graph, eventBusService } = service;\n    eventBusService.emit(SharedEvents.GRAPH_CHANGED, graph.toJSON());\n}\n\n// Paper\n\nfunction onPaperBlankPointerdown(service: JointPlusService, evt: dia.Event): void {\n    const { scroller } = service;\n    actions.setSelection(service, []);\n    scroller.startPanning(evt);\n}\n\nfunction onPaperPinch(service: JointPlusService, evt: dia.Event, ox: number, oy: number, scale: number) {\n    const { scroller } = service;\n    evt.preventDefault();\n    scroller.zoom(scale - 1, { min: ZOOM_MIN, max: ZOOM_MAX, grid: ZOOM_STEP, ox, oy });\n}\n\nfunction onPaperPan(service: JointPlusService, evt:dia.Event, tx: number, ty: number) {\n    const { scroller } = service;\n    evt.preventDefault();\n    scroller.el.scrollLeft += tx;\n    scroller.el.scrollTop += ty;\n}\n\nfunction onPaperCellPointerup(service: JointPlusService, cellView: dia.CellView): void {\n    actions.setSelection(service, [cellView.model]);\n}\n\nfunction onPaperElementPointermove(service: JointPlusService, elementView: dia.ElementView, evt: dia.Event): void {\n    const { paper } = service;\n    const { data } = evt;\n    // Run the code below on the first `pointermove` event only\n    if (data.pointermoveCalled) return;\n    data.pointermoveCalled = true;\n    paper.hideTools();\n}\n\nfunction onPaperElementPointerup(service: JointPlusService, _elementView: dia.ElementView, evt: dia.Event): void {\n    const { paper } = service;\n    const { data } = evt;\n    if (!data.pointermoveCalled) return;\n    paper.showTools();\n    actions.updateLinksRouting(service);\n}\n\nfunction onPaperElementPortAdd(_service: JointPlusService, elementView: dia.ElementView, evt: dia.Event): void {\n    evt.stopPropagation();\n    const message = elementView.model as shapes.app.Message;\n    message.addDefaultPort();\n}\n\nfunction onPaperElementPortRemove(_service: JointPlusService, elementView: dia.ElementView, evt: dia.Event): void {\n    evt.stopPropagation();\n    const portId = elementView.findAttribute('port', evt.target);\n    const message = elementView.model as shapes.app.Message;\n    message.removePort(portId);\n}\n\nfunction onPaperCellToolRemove(_service: JointPlusService, cellView: dia.CellView, _evt: dia.Event): void {\n    cellView.model.remove();\n}\n\nfunction onPaperScale(service: JointPlusService): void {\n    const { tooltip } = service;\n    tooltip.hide();\n}\n\n// Toolbar\n\nfunction onToolbarPNGPointerclick(service: JointPlusService): void {\n    actions.exportToPNG(service);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}